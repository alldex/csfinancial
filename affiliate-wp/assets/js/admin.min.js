jQuery(document).ready(function($){function maybe_activate_migrate_users_button(){var checked=$("#affiliate-wp-migrate-user-accounts input:checkbox:checked").length,$button=$("#affiliate-wp-migrate-user-accounts input[type=submit]");checked>0?$button.prop("disabled",!1):$button.prop("disabled",!0)}var file_frame;window.formfield="",$("body").on("click",".affwp_settings_upload_button",function(e){e.preventDefault();var button=$(this);return window.formfield=$(this).parent().prev(),file_frame?void file_frame.open():(file_frame=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:button.data("uploader_title"),button:{text:button.data("uploader_button_text")},multiple:!1}),file_frame.on("menu:render:default",function(view){var views={};view.unset("library-separator"),view.unset("gallery"),view.unset("featured-image"),view.unset("embed"),view.set(views)}),file_frame.on("insert",function(){var selection=file_frame.state().get("selection");selection.each(function(attachment,index){attachment=attachment.toJSON(),window.formfield.val(attachment.url)})}),void file_frame.open())});var file_frame;window.formfield="",$(".affwp-referrals-export-toggle").click(function(){$(".affwp-referrals-export-toggle").toggle(),$("#affwp-referrals-export-form").slideToggle()}),$("#affwp-referrals-export-form").submit(function(){if(!confirm(affwp_vars.confirm))return!1}),$(".affwp-datepicker").length&&$(".affwp-datepicker").datepicker(),$(".affwp-user-search").each(function(){var $this=$(this),$action="affwp_search_users",$search=$this.val(),$status=$this.data("affwp-status"),$user_id=$("#user_id");$this.autocomplete({source:ajaxurl+"?action="+$action+"&term="+$search+"&status="+$status,delay:500,minLength:2,position:{offset:"0, -1"},select:function(event,data){$user_id.val(data.item.user_id)},open:function(){$this.addClass("open")},close:function(){$this.removeClass("open")}}),$this.on("keyup",function(){this.value||$user_id.val("")})});var file_frame;$("body").on("click",".upload_image_button",function(e){e.preventDefault();var formfield=$(this).prev();return file_frame?void file_frame.open():(file_frame=wp.media.frames.file_frame=wp.media({frame:"select",title:"Choose Image",multiple:!1,library:{type:"image"},button:{text:"Use Image"}}),file_frame.on("menu:render:default",function(view){var views={};view.unset("library-separator"),view.unset("gallery"),view.unset("featured-image"),view.unset("embed"),view.set(views)}),file_frame.on("select",function(){var attachment=file_frame.state().get("selection").first().toJSON();formfield.val(attachment.url);var img=$("<img />");img.attr("src",attachment.url),$("#preview_image").empty().append(img),$("#preview_image img")&&$("#preview_image").show()}),void file_frame.open())}),$("body").on("click",".affiliates_page_affiliate-wp-referrals .delete",function(e){return!!confirm(affwp_vars.confirm_delete_referral)}),maybe_activate_migrate_users_button(),$("body").on("change","#affiliate-wp-migrate-user-accounts input:checkbox",function(){maybe_activate_migrate_users_button()}),$("#affwp_add_affiliate #status").change(function(){var status=$(this).val();"active"==status?$("#affwp-welcome-email-row").show():($("#affwp-welcome-email-row").hide(),$("#affwp-welcome-email-row #welcome_email").prop("checked",!1))}),"undefined"!=typeof postboxes&&postboxes.add_postbox_toggles(pagenow)});